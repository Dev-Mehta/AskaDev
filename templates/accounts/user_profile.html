{% extends "base.html" %}
{% load static %}
{% block body %}
<style type="text/css">
	.follow-btn, .follow-btn:focus{
		background: white;
		border: 2px solid var(--red);
		color: var(--red);
		padding: 4.5px 16px;
		border-radius: 8px;
		transition: 0.3s;
		outline: 0;
	}
	.follow-btn:hover{
		background: var(--red);
		color: white;
		text-decoration: none;
	}
	.following-btn, .following-btn:focus{
		background: var(--red);
		border: 2px solid var(--red);
		color: white;
		padding: 4.5px 16px;
		border-radius: 8px;
		transition: 0.3s;
		outline: 0;
	}
	.following-btn:hover{
		background: white;
		color: var(--red);
		text-decoration: none;
	}
	.table thead th, .table td{
		border: none;
		padding: 2px;
		vertical-align: top;
	}
	.badge{
		padding: 4px 18px;
		font-size: 16px;
		margin: 2px;
	}
	.skills{
		margin-top: 2rem;
	}
	.skills p{
		margin-bottom: 5px;
		font-size: 24px;
	}
	.active-pp{
		width: 14px;
		height: 14px;
		margin-top: -2px;
		margin-left: -15px;
		border-radius: 50%;
		position: absolute;
		background-color: #11e743;
		display: inline-block;
	}
</style>
<div id="app_profile">
<div class="container">
		<h4 id="profile_picture" style="
		display: inline-block;">
			<img  style="width: 50px;height: 50px;border-radius: 16px;" 
			src="{{profile.profile_picture.url}}" 
			class="img-fluid propicture">
			<div class="active-pp"></div>
			<span class="ml-1">{{ profile.user }}</span></h4>
		<span class="float-right" style="margin-top: 10px;">
			{% if sameUser %}
				<vs-button 
				href="{% url 'edit_profile' pk=user.id %}"
				color="danger"
				v-bind:style="{fontSize: '14px', border: 'none', fontWeight: '700',outline: 'none'}"
				size="small"
				type="border"
				v-on:click="message = 'Redirecting'"
				>
					[[message]]
				</vs-button>	
			{% else %}
					{% if canFollow %}
					<button class="follow-btn">{{text}}</button>
					{% else %}
					<button class="following-btn">{{text}}</button>
				{% endif %}    	
			{% endif %}
		</span>
		<div class="bio" style="max-width: 400px;">
		<h6 style="font-size: 24px;margin-top: 1rem">Bio</h6>
		<span id="bio">
		{{ profile.bio|linebreaks }}
		{% if profile.website %}
		<a target="_blank" style="margin-top: -20px;position: absolute;" href="{{profile.website}}">{{ profile.website }}</a>
		{% endif %}
		</span>
		</div>
		<div class="skills">
			<p>Languages</p>
			{% for l in profile.languages.all %}
			<vs-chip color="{{l.bg_color}}" type="filled">
				{{l}}
			</vs-chip>
			{% endfor %}
		</div>
		<br/>
		<p></p>
		<table class="table text-center">
			<thead>
				<th style="width: 33vw;"class="text-center" >Questions Asked</th>
				<th style="width: 33vw;"class="text-center" ><span id="followers">Followers</span></th>
				<th style="width: 33vw;"class="text-center" ><span id="following">Following</span></th>
			</thead>
			<tr class="col">
				<td>{{questions.count}}</td>
				<td id="followers_count">{{profile.followers.count}}</td>
				<td>{{profile.follows.count}}</td>
			</tr>
		</table>
</div>

<hr style="border: 1px solid var(--red);margin-top: 3px;">
<div class="container">
	{% if sameUser %}
	<h3>Your Questions</h3>
	{% else %}
	<h3>{{profile.user}}'s Questions</h3>
	{%  endif %}
	{% for q in questions %}
		<vs-row vs-justify="center">
			<vs-col type="flex" vs-justify="center" vs-align="center" vs-w="12">
			  <vs-card actionable class="cardx">
				<div slot="header">
				  <h3>
					{{q.title}}
				  </h3>		  
				  <p>
					{% for t in q.tags.all %}
						<vs-chip color="{{ t.bg_color }}">{{t.tag}}</vs-chip>
					{% empty %}
					<div class="badge badge-pill badge-dark">no tags</div>
					{% endfor %}
				</p>
				</div>
				<div slot="footer">
				  <vs-row vs-justify="flex-end">
					<vs-button 
					href="/{{q.user}}/questions/{{q.url}}/"
					type="filled" color="danger" icon="read_more">
						Read More
					</vs-button>
				  </vs-row>
				</div>
			  </vs-card>
			</vs-col>
		  </vs-row>	
		<br/>
		{% empty %}
			<h4>No Questions Asked</h4>
		{% endfor %}
</div>
</div>
<script type="text/javascript">
	var following = {{following}};
	var follow_btn = document.getElementsByTagName('BUTTON')[1];
	var init_text = "{{text}}"
	var followers = document.querySelector('#followers_count');
	function checkFollowing(){
		if(following){
		var x = document.querySelector('.following-btn');
		x.onclick = function(){
		x.classList.add('follow-btn')
	    x.classList.remove('following-btn')
	    x.innerText = "Follow"
	    following = false;
	    followers.innerText = parseInt(followers.innerText)-1;
	    checkFollowing();
	    	
		var xhttp = new XMLHttpRequest();
		xhttp.open("GET", "/unfollow/{{profile.user}}", true);
		xhttp.send();
		}
	}
	else{
			var x = document.querySelector('.follow-btn');
			x.onclick = function(){
				x.classList.add('following-btn')
		      	x.classList.remove('follow-btn')
		      	x.innerText = "Following"
		      	following = true;
		      	followers.innerText = parseInt(followers.innerText)+1;
		      	checkFollowing();
			var xhttp = new XMLHttpRequest();
		xhttp.open("GET", "/follow/{{profile.user}}", true);
		xhttp.send();
		}
	}	
	}
	if(following){
		var x = document.querySelector('.following-btn');
		x.onclick = function(){
			x.classList.add('follow-btn')
	      	x.classList.remove('following-btn')
	      	x.innerText = "Follow"
	      	followers.innerText = parseInt(followers.innerText)-1;
	      	following = false
	      	checkFollowing()
	    	
		var xhttp = new XMLHttpRequest();
		xhttp.open("GET", "/unfollow/{{profile.user}}", true);
		xhttp.send();
		}
		}
		else{
			var x = document.querySelector('.follow-btn');
			x.onclick = function(){
				x.classList.add('following-btn')
		      	x.classList.remove('follow-btn')
		      	x.innerText = "Following"
		      	following = true
		      	followers.innerText = parseInt(followers.innerText)+1;
		      	checkFollowing()
			var xhttp = new XMLHttpRequest();
		xhttp.open("GET", "/follow/{{profile.user}}", true);
		xhttp.send();
		}
	}
</script>
{% endblock %}
{% block script %}
<script>
const app_profile = new Vue({
	el: '#app_profile',
	delimiters: ['[[',']]'],
	data: {
		'message': 'Edit Profile'
	}
})
</script>
{% endblock %}